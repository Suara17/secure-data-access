根据你的开题报告设计 和数据库结构，你的系统采用的是 **强制访问控制 (MAC)** 结合 **多维安全标记** 的逻辑。

为了让你彻底理解，我将这个“可访问检查逻辑”拆解为 **“三层漏斗”模型**。每一个请求必须通过所有层级的检查，才能最终拿到数据。

### 核心逻辑图解

你可以想象数据被锁在一个保险柜里，打开这个保险柜需要两把钥匙：**“等级钥匙”** 和 **“职能钥匙”**。

```mermaid
graph TD
    A[用户发起请求] --> B{第一层：身份核验};
    B -- 认证失败 --> Z[拒绝 (401)];
    B -- 认证成功 --> C{第二层：等级检查 (纵向)};
    C -- 级别不足 --> Z[拒绝 (DENY) + 审计];
    C -- 级别达标 --> D{第三层：范畴/职能检查 (横向)};
    D -- 部门不匹配 --> Z[拒绝 (DENY) + 审计];
    D -- 匹配 或 豁免 --> E[允许访问 (ALLOW) + 审计];

```

---

### 第一层：等级检查 (纵向控制 - BLP模型)

**逻辑口诀：下读上写（Read Down, Write Up）**
这是军事安全模型（Bell-LaPadula）的核心。

* **规则**：用户的安全等级必须 **大于等于 ()** 数据的安全等级。
* **目的**：防止低密级人员（如实习生）窥探高密级数据（如机密战略）。
* **具体判定**：
* `User Level Weight` vs `Data Level Weight`
* **示例**：
* **总经理 (机密/Level 4)**  **员工薪资 (内部/Level 2)**  **通过** ✅
* **实习生 (公开/Level 1)**  **技术文档 (秘密/Level 3)**  **拦截** ❌





### 第二层：范畴检查 (横向控制 - 部门隔离)

**逻辑口诀：专款专用，公开豁免**
这是为了防止即使等级够高，也不应跨越职能去查看不相关的数据（Need-to-know principle）。

* **规则**：用户的“职能部门”必须 **等于 ()** 数据的“归属部门”。
* **例外豁免（非常重要）**：
1. **数据是公开的**：如果数据密级是 `Level 1 (公开)`，则忽略部门限制。
2. **数据是公共区域的**：如果数据属于 `综合部/公共区` (例如 `category_id=4`)，则全员可见。


* **具体判定**：
* `(User Category == Data Category)` OR `(Data Level == Public)` OR `(Data Category == General)`
* **示例**：
* **人事经理 (人事部)** 查看 **研发部代码 (研发部)**  **拦截** ❌ (虽然人事经理可能是秘密级，等级够，但部门不对)。
* **研发组长 (研发部)** 查看 **放假通知 (综合部)**  **通过** ✅ (因为综合部是公共范畴)。
* **财务总监 (财务部)** 查看 **公司对外宣传稿 (市场部/公开级)**  **通过** ✅ (因为数据是公开级，豁免部门限制)。





### 第三层：审计与决策 (留痕)

**逻辑口诀：雁过留声**
无论前两层是通过还是拒绝，**必须**记录下来。这不仅是功能，更是合规性要求。

* **逻辑**：
* 如果 `Level Check` AND `Category Check` 都为 True  结果 **ALLOW**。
* 只要有一个为 False  结果 **DENY**，并记录具体死在哪一步（如“等级不足”或“职能不匹配”）。
